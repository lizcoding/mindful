{% extends 'base.html' %}

{% block title %}Item {{ item.item_id }}{% endblock %}

{% block content %}
<div id="item-page" class="content-block container-fluid">
  <div id="item-block" class="container">
    <div class="row gx-5 row-cols-sm-6 row-cols-xs-6 row-cols-md-6 row-cols-lg-12 row-cols-xl-12">
      <div class="col-md">
        <div class="d-flex justify-content-center">
          <div style="position: relative; padding: 0.5rem;">
            
            <div class="item-info">
              {% if item.retailer %}
              <div class="info-banner" id="return-info">{{item.retailer.name}} </div>
                {% if item.brand and (item.brand != item.retailer.name) %}
                <div class="info-banner" id="return-info">{{item.brand}} </div>
                {% endif %}
              {% endif %}
              <div class="info-banner" id="return-info">${{item.price}} </div>
            </div>
            
            <img id="item-img" class="item-fluid" src="{{ item.images[0].cloudinary_url }}">

          </div>
        </div>
      </div>
      <div class="col-md">
        <div>
          <div class="reflection-container">
            <h1 id="reflection-header">MINDFUL ANALYSIS</h1>
            <div id="reflection-entry">
              <p>Mindful Reflection 02/06/2022</p>
              <p style="margin: 0;">
                "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. 
                Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor
                in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, 
                sunt in culpa qui officia deserunt mollit anim id est laborum."
              </p>
            </div>
            <!-- Display Reflection Results -->
            <div id="reflection-results">
              {% if item.sentiments %}            
                <p>Based on your 
                  {% if item.sentiments|length == 1 %} first journal entry,
                  {% else %} previous {{item.sentiments|length}} journal entries,
                  {% endif %} you 
                  {% if overall_score < 0.50 %} should consider returning this item or create a back-up plan!
                  {% elif overall_score < 0.70 %} seem to like the item. Reflect more on this purchase before making a decision!
                  {% else %} really enjoy this item! We reccommend keeping it! Way to go!
                  {% endif %}
                </p>

              {% else %}
              <p style="margin: 0;">"Based on your last 9 reflections, you seem to really enjoy this item! We reccommend keeping it! Way to go!"</p>
              {% endif %}

              </div>
          </div>

          <div id="item-details">
                {% if days_left.days >= 0 and (item.return_type != "ineligable") %}
                <div>
                  {% if days_left.days == 0 %}
                    <p style="color:red;">Your return deadline is today!</p>
                  {% endif %}
      
                  {% if days_left.days < 0 %}
                    <p style="color:red;">Item has passed return window. Make a back-up plan!</p>
                  {% endif %}
      
                  {% if days_left.days > 0 %}
                  <p>Return Deadline {{ item.return_deadline }} <br>{{days_left.days}} days left to return</p>
                  {% endif %}
                </div>
                {% endif %}

                {% if item.plan %}
                  <p>{{ item.plan[0].action }} Plan</p>
                {% endif %}
    
                {% if not (item.plan and item.sentiments) %}
                <div>
                  {% if item.sentiments and item.plan %}
                  {% if item.sentiments[-1].date != today %}
                  <p>Mindful Tasks: </p>
                  {% endif %}
                  {% elif not (item.plan and item.sentiments) %} 
                  <p>Mindful Tasks: </p>
                  {% endif %}
                  {% if not item.plan %}
                  <li>Create a Plan</li>
                  {% endif %}
                  {% if not item.sentiments %}
                  <li>Write a purchase reflection</li>
                  {% endif %}
                  {% if item.sentiments %}
                  {% if item.sentiments[-1].date != today %}
                  <!-- Every-Day, twice a week, or weekly (allow user to choose days) -->
                  <li>Write a purchase reflection</li>
                  {% endif %}
                  {% endif %}
                </div>
                {% endif %}
          </div>    

          <div class="btn-group item-buttons" role="group" aria-label="Item Buttons">
            {% if not item.plan %}
              <!-- Create Plan button -->
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createPlanModal">
              Create Plan
              </button></h4>
            {% else %}
              <button class="btn btn-primary">
                <a href="/plan/{{item.plan[0].plan_id}}" style="color: white;">View Plan</a>
              </button>
            {% endif %}
            {% if not item.sentiments %}
            {% if not item.sentiments or (item.sentiments[-1].date != today) %}
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#enterReflectionModal">
              Enter Reflection
              </button></h4>
            {% endif %}
            {% endif %}
            
            <!-- Keep Item button -->
            <a class="btn btn-primary" href="/item/{{item.item_id}}/keep" role="button">Keep Item</a>
              
            <!-- Delete Item button -->
            <a class="btn btn-primary" href="/item/{{item.item_id}}/delete" role="button">Delete Item</a>
    
          </div>
        </div>
      </div>  
    </div>
  </div>
</div>


<div class="modal fade" id="createPlanModal" tabindex="-1" role="dialog" aria-labelledby="createPlanModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="createPlanModalTitle">Create Plan</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
    </div>

<div class="modal-body">
    <div class="d-flex">
      <form action="/item/{{item.item_id}}/add_plan" method="POST">
        <div>
          <label>Action: </label>
          {% if days_left.days >= 0 and (item.return_type != "ineligable") %}
            <label>Return</label>
            <input type="radio" name="action" value="Return" required>
          {% endif %}
          <label>Donate</label>
          <input type="radio" name="action" value="Donate" required>
          <label>Gift</label>
          <input type="radio" name="action" value="Gift" required>
          <label>Resell</label>
          <input type="radio" name="action" value="Resell" required>
        </div>
        <button type="submit" class="btn btn-primary">Add Plan</button>
      </form>
    </div>
  </div>
  </div>
</div>
</div>

<div class="modal fade" id="enterReflectionModal" tabindex="-1" role="dialog" aria-labelledby="enterReflectionModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title" id="enterReflectionModalTitle">Enter Reflection</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
          </button>
      </div>

      <div class="modal-body">
        <div class="d-flex">
          <form action="/item/{{item.item_id}}/enter_reflection" method="POST">
            <div>
              <label for="reflection">Write a short reflection (30-500 characters) on your purchase. Are you
                happy that you bought the item, or are you undecided? Is the item what you expected? Have you tried
                on the item? How does the item fit? How much use will you get out of this item? Is the item worth
                the price you paid? How satisfied are you with the purchase?</label>
              <textarea id="reflection" name="reflection" rows="4" cols="50" minlength="30" maxlength="500" required></textarea>  
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}